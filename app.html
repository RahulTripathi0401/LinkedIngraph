<html>
  <head>
    <title>LinkedIn graph Visualisation</title>
    <style type="text/css">
      #mynetwork {
        width: 100%;
        height: 100%;
        border: 1px solid lightgray;
      }
    </style>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  </head>
  <body>
    <p>Dynmaic LinkedIn graph Visualisation</p>
    <div>
      <input id="searchKeyword" type="text" placeholder="Keyword" />
      <button id="existing">Search Existing Graphs</button>
    </div>
    <div>
      <input type="text" placeholder="Keyword" id="search" />
      <button id="show">Create New Graph</button>
    </div>
    <div id="mynetwork"></div>

    <script type="text/javascript">
      const showGraph = document.getElementById("show");
      const searchGraph = document.getElementById("existing");
      const options = {
        manipulation: false,
        height: "90%",
        layout: {
          hierarchical: {
            enabled: true,
            levelSeparation: 300,
          },
        },
        physics: {
          hierarchicalRepulsion: {
            nodeDistance: 300,
          },
        },
      };
      searchGraph.addEventListener("click", async () => {
        const searchWord = String(document.getElementById("searchKeyword").value);
        let flag = false;
        let data = await fetch(`http://localhost:3000/connections/${searchWord}`, {
          method: "GET",
        })
          .then((response) => {
            if (response.ok) {
              flag = true;
              return response.json();
            }
          })
          .catch((err) => {
            // There was an error
            console.warn("Something went wrong.", err);
          });
        const edges = JSON.parse(data);
        data = await fetch(`http://localhost:3000/nodes/${searchWord}`, {
          method: "GET",
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            }
          })
          .catch((err) => {
            // There was an error
            console.warn("Something went wrong.", err);
          });
        if (flag) {
          const nodes = JSON.parse(data);
          var container = document.getElementById("mynetwork");
          var info = { nodes: nodes, edges: edges };
          var gph = new vis.Network(container, info, options);
        }
      });

      showGraph.addEventListener("click", async () => {
        const searchWord = String(document.getElementById("search").value);
        console.log("here");
        let data = await fetch(`http://localhost:3000/launch/${searchWord}`, {
          method: "POST",
        })
          .then((response) => {
            if (response.ok) {
              return response.json();
            }
          })
          .catch((err) => {
            // There was an error
            console.warn("Something went wrong.", err);
          });
      });
    </script>
  </body>
</html>
